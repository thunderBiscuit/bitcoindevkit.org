(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{362:function(t,e,a){"use strict";a.r(e);var s=a(6),n=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"introduction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),e("h3",{attrs:{id:"compact-filters"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#compact-filters"}},[t._v("#")]),t._v(" Compact Filters:")]),t._v(" "),e("p",[t._v("Compact filters are the latest specification of Bitcoin SPV node implementation as per "),e("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[t._v("BIP157"),e("OutboundLink")],1),t._v(" and "),e("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0158.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[t._v("BIP158"),e("OutboundLink")],1),t._v(". Such light clients were envisioned by Satoshi himself in  his original white paper, but due to lack of robust privacy and trust guarantees using conventional "),e("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[t._v("bloomfilters"),e("OutboundLink")],1),t._v(", these type of nodes never got popular.")]),t._v(" "),e("p",[t._v("Enters "),e("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[t._v("BIP157"),e("OutboundLink")],1),t._v(", which described a new type of filters for Bitcoin Blockchain data, known as "),e("code",[t._v("compact_filters")]),t._v(". The "),e("a",{attrs:{href:"https://github.com/lightninglabs/neutrino",target:"_blank",rel:"noopener noreferrer"}},[t._v("Neutrino"),e("OutboundLink")],1),t._v(' project pioneered the use of compact filter based light client nodes for using with Lightning Network wallets. Using compact filters, a light-node can talk to one or more full nodes, and fetch relevant information from the blockchain, with much more robust privacy and security guarantees than previously possible. Compact filter based nodes are best suitable to be used with mobile wallets, to create more trustless mobile applications on Bitcoin. Any wallet application that needs to have an "eye on the blockchain" has an use for such light clients.')]),t._v(" "),e("p",[e("code",[t._v("BIP157")]),t._v(" type filters allows to create tiny sized SPV nodes, that can fetch blockchain data and can identify inconsistency, so it can actively defend itself, while also preserving its privacy. Such nodes are most useful for Lightning Network mobile applications.")]),t._v(" "),e("p",[t._v("Example of such "),e("code",[t._v("compact_filters")]),t._v(" wallets in wild is "),e("a",{attrs:{href:"https://github.com/breez/breezmobile",target:"_blank",rel:"noopener noreferrer"}},[t._v("Breeze"),e("OutboundLink")],1),t._v(" Lightning mobile wallet.")]),t._v(" "),e("p",[t._v("Bitcoin core supports serving "),e("code",[t._v("BIP157")]),t._v(" type filters from "),e("code",[t._v("v0.21.0")]),t._v(".")]),t._v(" "),e("h3",{attrs:{id:"bdk-and-compact-filters"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#bdk-and-compact-filters"}},[t._v("#")]),t._v(" BDK and Compact filters")]),t._v(" "),e("p",[t._v("BDK is a bitcoin wallet development library that can be used to create bitcoin wallets with custom "),e("code",[t._v("Database")]),t._v(" and "),e("code",[t._v("Blockchain")]),t._v(" backends. BDK is a "),e("a",{attrs:{href:"https://bitcoindevkit.org/descriptors/",target:"_blank",rel:"noopener noreferrer"}},[t._v("descriptor"),e("OutboundLink")],1),t._v(" based wallet, i.e. the wallet keychain is described by a set of descriptors.")]),t._v(" "),e("p",[t._v("Using BDK one can instantiate wallets of various kinds as per requirement. BDK abstracts away all the heavy lifting works, and allow wallet devs to concentrate on logic that they care about, i.e. writing wallet codes. For more detailed documentation on BDK capabilities check these "),e("a",{attrs:{href:"https://bitcoindevkit.org/blog/2020/12/hello-world/",target:"_blank",rel:"noopener noreferrer"}},[t._v("blog"),e("OutboundLink")],1),t._v(", "),e("a",{attrs:{href:"https://bitcoindevkit.org/blog/2020/11/descriptors-in-the-wild/",target:"_blank",rel:"noopener noreferrer"}},[t._v("bog"),e("OutboundLink")],1),t._v(" and "),e("a",{attrs:{href:"https://docs.rs/bdk/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("p",[t._v("The main three components of abstraction in BDK are")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Database")])]),t._v(" "),e("li",[e("code",[t._v("Descriptors")])]),t._v(" "),e("li",[e("code",[t._v("Blockchain")])])]),t._v(" "),e("p",[t._v("BDK comes with default implementations of all them that developers can start with out of the box. Developers can also create there own custom implementations and plug it into BDK (thanks to rust magic of "),e("code",[t._v("Traits")]),t._v(").")]),t._v(" "),e("p",[t._v("BDK also supports "),e("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0158.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[t._v("BIP158"),e("OutboundLink")],1),t._v(" communication protocol, which allows creation of "),e("code",[t._v("BIP157")]),t._v(" type compact filter SPV nodes. This capability is extended to wallet with BDK's "),e("code",[t._v("Blockchain")]),t._v(" data structure. The "),e("a",{attrs:{href:"https://docs.rs/bdk/0.8.0/bdk/blockchain/trait.Blockchain.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("API"),e("OutboundLink")],1),t._v(" for "),e("code",[t._v("compact_filters")]),t._v(" backend is similar to any other kind of backends, so wallet devs don't need to worry about all the details. Its ok if the dev haven't even heard of "),e("code",[t._v("BIP157")]),t._v(", BDK takes care of that in background.")]),t._v(" "),e("p",[t._v("This capability can be unlocked by compiling BDK with the "),e("code",[t._v("compact_filters")]),t._v(" feature. Once enabled, BDK will be able to create wallets with the "),e("code",[t._v("compact_filters")]),t._v(" type "),e("code",[t._v("Blockchain")]),t._v(" backend. (The default backend is electrum server)")]),t._v(" "),e("h3",{attrs:{id:"bdk-cli"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#bdk-cli"}},[t._v("#")]),t._v(" bdk-cli")]),t._v(" "),e("p",[e("code",[t._v("bdk-cli")]),t._v(" is a lightweight "),e("a",{attrs:{href:"https://codewith.mu/en/tutorials/1.0/repl",target:"_blank",rel:"noopener noreferrer"}},[t._v("REPL"),e("OutboundLink")],1),t._v(" wrapper over the BDK library to facilitate quick and easy demonstration of BDK capabilities in command-line. Wallet devs can use this tool to quickly try out different possibilities with BDK.")]),t._v(" "),e("p",[t._v("In this tutorial, We will use "),e("code",[t._v("bdk-cli")]),t._v(" to demonstrate some basic wallet functionalities using "),e("code",[t._v("compact_filters")]),t._v(" backend.")]),t._v(" "),e("h2",{attrs:{id:"tutorial-scope"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tutorial-scope"}},[t._v("#")]),t._v(" Tutorial Scope")]),t._v(" "),e("p",[t._v("Basic wallet workflow we will cover:")]),t._v(" "),e("ul",[e("li",[t._v("create and sync a wallet,")]),t._v(" "),e("li",[t._v("receive a transaction,")]),t._v(" "),e("li",[t._v("create a transaction,")]),t._v(" "),e("li",[t._v("sign and broadcast the transaction,")]),t._v(" "),e("li",[t._v("fetch updated balance,")])]),t._v(" "),e("p",[t._v("The BDK wallet will have a "),e("code",[t._v("BIP157")]),t._v(" SPV backend (aka "),e("code",[t._v("compact_filters")]),t._v(" backend) that will connect with a Bitcoin core node serving filter data.")]),t._v(" "),e("p",[t._v("It will publish and extract transaction data through that node.")]),t._v(" "),e("p",[t._v("We will have a Bitcoin Core wallet and a BDK wallet, sending and receiving transactions between each other, in regtest.")]),t._v(" "),e("h2",{attrs:{id:"prerequisites"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),e("p",[t._v("Following things are required to start with the tutorial.")]),t._v(" "),e("ol",[e("li",[t._v("A Bitcoin Core regtest node listening at "),e("code",[t._v("localhost:18444")]),t._v(" signalling for compact filter support.")]),t._v(" "),e("li",[e("code",[t._v("bdk-cli")]),t._v(" compiled with "),e("code",[t._v("compact_filter")]),t._v(" features.")])]),t._v(" "),e("p",[t._v("If you already have these two setup and working, you can skip this and jump to the "),e("a",{attrs:{href:"#tutorial"}},[t._v("Tutorial")]),t._v(" section.")]),t._v(" "),e("h3",{attrs:{id:"install-and-run-bitcoind"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#install-and-run-bitcoind"}},[t._v("#")]),t._v(" Install and run "),e("code",[t._v("bitcoind")])]),t._v(" "),e("p",[t._v("You can definitely do it with your own "),e("code",[t._v("bitcoind")]),t._v(" installation. "),e("code",[t._v("BIP157")]),t._v(" support has been included in Bitcoin Core "),e("code",[t._v("v0.21.0")]),t._v(". So anything above that will work.")]),t._v(" "),e("p",[t._v("You also need to ensure proper configuration settings for signalling "),e("code",[t._v("compact_filters")]),t._v(" support.")]),t._v(" "),e("p",[t._v("For ease of testing, the BDK project hosts docker images that can be used to spawn Bitcoin Core with all the relevant configurations.")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("spawn a regtest node using "),e("a",{attrs:{href:"https://github.com/bitcoindevkit/bitcoin-regtest-box",target:"_blank",rel:"noopener noreferrer"}},[t._v("bitcoin-regtest-box"),e("OutboundLink")],1),t._v(" docker file.")]),t._v(" "),e("p",[t._v("Start the regtest box docker container.")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run --detach --rm -p "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:18443-18444:18443-18444/tcp --name bdk-box bitcoindevkit/bitcoind\n")])])]),e("p",[t._v("This will spin up a docker container running "),e("code",[t._v("bicoind")]),t._v(" and listening to port "),e("code",[t._v("18444")]),t._v(" and "),e("code",[t._v("18333")]),t._v(". You can keep this terminal alive to see communication events with BDK and the node.")])]),t._v(" "),e("li",[e("p",[t._v("Check node is reachable")]),t._v(" "),e("p",[t._v("In another terminal try connecting to the node with "),e("code",[t._v("bitcoin-cli")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it bdk-box /root/bitcoin-cli -regtest getnetworkinfo\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"version"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("210000")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"subversion"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/Satoshi:0.21.1/"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"protocolversion"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("70016")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localservices"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0000000000000449"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localservicesnames"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NETWORK"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WITNESS"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"COMPACT_FILTERS"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NETWORK_LIMITED"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("p",[t._v("In the output, the "),e("code",[t._v("version")]),t._v(" should show "),e("code",[t._v("210000")]),t._v(". "),e("code",[t._v("localservicesnames")]),t._v(" should contain "),e("code",[t._v('"COMPACT_FILTERS"')]),t._v(". If you see this, then Bitcoin Core is correctly configured.")])])]),t._v(" "),e("h3",{attrs:{id:"install-and-run-bdk-cli"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#install-and-run-bdk-cli"}},[t._v("#")]),t._v(" Install and run bdk-cli")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Install "),e("code",[t._v("bdk-cli")]),t._v(" with "),e("code",[t._v("compact_filters")]),t._v(" feature")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ cargo "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --git https://github.com/bitcoindevkit/bdk-cli.git bdk-cli --features compact_filters\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Check installation")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ bdk-cli --help\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nUSAGE:\n    bdk-cli "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SUBCOMMAND"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nFLAGS:\n    -h, --help Prints "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("help")]),t._v(" information\n    -V, --version Prints version information\nOPTIONS:\n    -n, --network "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("NETWORK"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Sets the network "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("default: testnet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nSUBCOMMANDS:\n    "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("help")]),t._v("      Prints this message or the "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("help")]),t._v(" of the given subcommand"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    key       Key management sub-commands\n    repl      Enter REPL "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" loop mode\n    wallet    Wallet options and sub-commands\n")])])])])]),t._v(" "),e("p",[t._v("Once these are setup correctly, you can start with the tutorial next.")]),t._v(" "),e("h2",{attrs:{id:"tutorial"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tutorial"}},[t._v("#")]),t._v(" Tutorial")]),t._v(" "),e("p",[t._v("[Note: For brevity "),e("code",[t._v("bdk-cli")]),t._v(" results are stored in command line variables using "),e("code",[t._v("jq")]),t._v(" tool. It is recommended to check the full results to see different information returned by "),e("code",[t._v("bdk-cli")]),t._v(" commands.]")]),t._v(" "),e("h3",{attrs:{id:"bitcoin-core-wallet-generation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#bitcoin-core-wallet-generation"}},[t._v("#")]),t._v(" Bitcoin Core Wallet Generation")]),t._v(" "),e("p",[t._v("This is standard procedure with "),e("code",[t._v("bitcoin-cli")]),t._v(".")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Create a wallet and generate 101 blocks.")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it bdk-box /root/bitcoin-cli -regtest createwallet "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"warning"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it bdk-box /root/bitcoin-cli -regtest getnewaddress\nbcrt1qatd7yq0jukwusuaufltlejmeydpvnpv43r5gc2\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it bdk-box /root/bitcoin-cli -regtest generatetoaddress "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),t._v(" bcrt1qatd7yq0jukwusuaufltlejmeydpvnpv43r5gc2\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3813ed6eb716f4743b9657d918799acf743add985a8ded28d8aa3629dd4496b6"')]),t._v(",\n"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"70da855913bdf791b6e458c611cebdef79b7a9840eb103ce58c71c1c7e3c49bc"')]),t._v(",\n"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"682ca732ef72719cd6f82c5047c7690fb1cd2df2543d035ac4ea99e974b8d172"')]),t._v(",\n"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"78799e4771017d4f46aa3c240054e2d61f54cea07ec44cb18ae712761e0aaa1e"')]),t._v(",\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it bdk-box /root/bitcoin-cli -regtest getbalance\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50.00000000")]),t._v("\n")])])]),e("p",[t._v("Now the core wallet has generated new blocks and is funded with test bitcoin.")])])]),t._v(" "),e("h3",{attrs:{id:"bdk-wallet-generation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#bdk-wallet-generation"}},[t._v("#")]),t._v(" BDK Wallet Generation")]),t._v(" "),e("p",[t._v("BDK is a descriptor based wallet library. So in order to use it we will need some descriptors to work with.")]),t._v(" "),e("p",[t._v("BDK wallet will ask for two descriptors as input, corresponding to "),e("code",[t._v("receive")]),t._v(" and "),e("code",[t._v("change")]),t._v(" addresses. Its recommended to have these two descriptors separate as BDK will handle them separately and ensure "),e("code",[t._v("change")]),t._v(" addresses are never used for receiving funds.")]),t._v(" "),e("p",[t._v("Or developers can decide to use a single descriptor too, in that case BDK will use that descriptor for deriving both "),e("code",[t._v("receive")]),t._v(" and "),e("code",[t._v("change")]),t._v(" addresses.")]),t._v(" "),e("p",[t._v("We will use "),e("code",[t._v("bdk-cli")]),t._v(" itself to generate such descriptors.")]),t._v(" "),e("ul",[e("li",[e("h4",{attrs:{id:"generate-a-privatekey"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#generate-a-privatekey"}},[t._v("#")]),t._v(" Generate a privatekey")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BDK_xprv")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("bdk-cli key generate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" jq -r "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.xprv'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_xprv")]),t._v("\ntprv8ZgxMBicQKsPefY7tdq7EKny81n9tfSvUYfSHAZByXdjPAZVysvaB6sFd2YavqfqMBgbHaXUG5oWM6sYvdJn6vnUizzQKTYAJ36bQsfPv4N\n")])])]),e("p",[e("code",[t._v("bdk-cli key generate")]),t._v(" will generate a fresh master key with "),e("code",[t._v("mnemonic")]),t._v(" and "),e("code",[t._v("xprv")]),t._v(". We have extracted the value of extended private key and stored it in "),e("code",[t._v("BDK_xprv")]),t._v(" variable.")]),t._v(" "),e("p",[t._v("The returned "),e("code",[t._v("mnemonic")]),t._v(" can be used to restore back the wallet if wallet data directory is lost.")])]),t._v(" "),e("li",[e("h4",{attrs:{id:"generate-descriptors"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#generate-descriptors"}},[t._v("#")]),t._v(" Generate Descriptors")]),t._v(" "),e("p",[e("code",[t._v("bdk-cli key derive")]),t._v(" can derive an "),e("code",[t._v("xpub")]),t._v("s given a "),e("code",[t._v("master key")]),t._v(" and "),e("code",[t._v("derivation_path")]),t._v(".")]),t._v(" "),e("p",[t._v("We will use the following paths for our "),e("code",[t._v("receive")]),t._v(" and "),e("code",[t._v("change")]),t._v(" descriptors")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("receive")]),t._v(" path: "),e("code",[t._v("m/84h/1h/0h/0")])]),t._v(" "),e("li",[e("code",[t._v("change")]),t._v(" path: "),e("code",[t._v("m/84h/1h/0h/1")]),t._v(",")])]),t._v(" "),e("p",[t._v("We can then simply wrap them in a "),e("code",[t._v('"wpkh()"')]),t._v(" to create our descriptors string and store them.")]),t._v(" "),e("p",[t._v("When asked for a new address, BDK will derive one from the "),e("code",[t._v("receive")]),t._v(" descriptor.")]),t._v(" "),e("p",[t._v("And while constructing transaction, BDK will use the "),e("code",[t._v("change")]),t._v(" descriptor to derive change address.")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BDK_recv_desc")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wpkh('),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("bdk-cli key derive --path m/84h/1h/0h/0 --xprv $BDK_xprv "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" jq -r "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.xprv'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(')"')]),t._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_recv_desc")]),t._v("\nwpkh"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ff09c7c9/84"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/1'")]),t._v("/0'/0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("tprv8hkdEGgwLLnqsdfkJFidpTj5d6z5qFdP6Qwzsviea3HrS9C2mXXaDivPKCCgcaWvnGNX9eciLUQs91PWYXJqrChfnAagViCgG6L5phaNyWr/*"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BDK_chng_desc")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wpkh('),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("bdk-cli key derive --path m/84h/1h/0h/1 --xprv $BDK_xprv "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" jq -r "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.xprv'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(')"')]),t._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_chng_desc")]),t._v("\nwpkh"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ff09c7c9/84"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/1'")]),t._v("/0'/1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("tprv8hkdEGgwLLnqtbYkGG7fSy7v43RF2SQGGjNuZtmBzEHh7H8xgpXBETQAbVPqi8rkvLNFKLYY4rDzXA4fn5Ha1yuazZqhQPe3uNKmFS7648s/*"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("Note: "),e("code",[t._v("BDK_xprv")]),t._v(" has been used as the "),e("code",[t._v("master key")]),t._v(", this will allow BDK to have signing capabilities.\nWe could have used an "),e("code",[t._v("xpub")]),t._v(" master key here instead, that would create an "),e("code",[t._v("watch-only")]),t._v(" wallet.")])]),t._v(" "),e("li",[e("h4",{attrs:{id:"create-and-sync-a-wallet"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-and-sync-a-wallet"}},[t._v("#")]),t._v(" Create and Sync a wallet")]),t._v(" "),e("p",[t._v("We will now instruct BDK to create a new wallet with following instructions")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ bdk-cli --network regtest wallet --node "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:18444"')]),t._v(" --wallet bdk-test -d "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_recv_desc")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_chng_desc")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("ul",[e("li",[t._v("name ("),e("code",[t._v("--wallet")]),t._v(") "),e("code",[t._v("bdk-test")]),t._v(",")]),t._v(" "),e("li",[e("code",[t._v("receive")]),t._v(" descriptor ("),e("code",[t._v("-d")]),t._v(") as "),e("code",[t._v("$BDK_recv_desc")]),t._v(" and change descriptor ("),e("code",[t._v("-c")]),t._v(") as "),e("code",[t._v("$BDK_chng_desc")]),t._v(",")]),t._v(" "),e("li",[t._v("connected to a full node ("),e("code",[t._v("--node")]),t._v(") listening at "),e("code",[t._v("127.0.0.1:18444")]),t._v(",")]),t._v(" "),e("li",[t._v("and finally create and sync the wallet with the "),e("code",[t._v("sync")]),t._v(" command.")])]),t._v(" "),e("p",[t._v("If you are using a "),e("code",[t._v("regtest")]),t._v(" node, also add "),e("code",[t._v("--network regtest")]),t._v(", the default is "),e("code",[t._v("testnet")]),t._v(".")]),t._v(" "),e("p",[e("code",[t._v("bdk-cli")]),t._v(" makes multiple parallel connections that can be configured with the "),e("code",[t._v("--conn-count")]),t._v(" parameter (default is 4). This makes syncing parallel and fast. Use "),e("code",[t._v("bdk-cli --help")]),t._v(" to see all other options.")]),t._v(" "),e("p",[t._v("Getting an empty return means wallet creation succeeded.")]),t._v(" "),e("p",[t._v("BDK has created a wallet named "),e("code",[t._v("bdk-test")]),t._v(" in its data directory. Which is by default stored at "),e("code",[t._v("~/.bdk-bitcoin/compact_filters")]),t._v(" folder.")]),t._v(" "),e("p",[t._v("Looking into that folder different files and directories maintained by BDK can be seen.")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" .bdk-bitcoin/compact_filters/\n000004.log  CURRENT   LOCK  MANIFEST-000003  OPTIONS-000010\nbdk-test    IDENTITY  LOG   OPTIONS-000008\n")])])])])]),t._v(" "),e("h3",{attrs:{id:"recieve-coins"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#recieve-coins"}},[t._v("#")]),t._v(" Recieve Coins")]),t._v(" "),e("p",[t._v("We will use the "),e("code",[t._v("core")]),t._v(" wallet to send 5 BTC to our"),e("code",[t._v("bdk-test")]),t._v(" wallet.")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Fetch a new address using "),e("code",[t._v("bdk-cli")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ bdk-cli --network regtest wallet --node "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:18444"')]),t._v(" --wallet bdk-test -d "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_recv_desc")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_chng_desc")]),t._v(" get_new_address\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"address"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bcrt1qx2479wywulf50pqx5uy64zhxq9f3tuvlh8u0s9"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Transfer funds to the previous address and generate a block, using "),e("code",[t._v("bitcoin-cli")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it bdk-box /root/bitcoin-cli -regtest sendtoaddress bcrt1qx2479wywulf50pqx5uy64zhxq9f3tuvlh8u0s9 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n\n\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it bdk-box /root/bitcoin-cli -regtest generatetoaddress "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" bcrt1qw3ht9xtc9pgyvmqay0ap9fw8mxd27az8el0uz3\n")])])]),e("p",[e("code",[t._v("core")]),t._v(" has sent 5 BTC to our "),e("code",[t._v("bdk-test")]),t._v(" wallet. Which is confirmed in a new block.")]),t._v(" "),e("p",[e("code",[t._v("bdk-test")]),t._v(" can see that now by syncing again.")]),t._v(" "),e("p",[t._v("(Note: BDK required explicit "),e("code",[t._v("sync()")]),t._v(" calls to give wallet developers flexibility on when to sync).")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ bdk-cli --network regtest wallet --node "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:18444"')]),t._v(" --wallet bdk-test -d "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_recv_desc")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_chng_desc")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n$ bdk-cli --network regtest wallet --node "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:18444"')]),t._v(" --wallet bdk-test -d "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_recv_desc")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_chng_desc")]),t._v(" get_balance\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"satoshi"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("500000000")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("We can see "),e("code",[t._v("500000000")]),t._v(" sats balance in our "),e("code",[t._v("bdk-test")]),t._v(" wallet.")]),t._v(" "),e("p",[t._v("BDK has fetched blockchain details concerning its wallet descriptors, from the core node, using compact filters.")])])]),t._v(" "),e("h3",{attrs:{id:"creating-a-transaction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-transaction"}},[t._v("#")]),t._v(" Creating a transaction.")]),t._v(" "),e("p",[t._v("Now we want to create a transaction sending coins from "),e("code",[t._v("bdk-test")]),t._v(" wallet to the "),e("code",[t._v("core")]),t._v(" wallet.")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("fetch a new "),e("code",[t._v("core")]),t._v(" address")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("core_addrs")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it bdk-box /root/bitcoin-cli -regtest getnewaddress "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("tr")]),t._v(" -d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\r'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Create a raw transaction using "),e("code",[t._v("bdk-cli")]),t._v(" to the above address. This will generate a "),e("code",[t._v("psbt")]),t._v(" which we will sign.")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("psbt")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("bdk-cli --network regtest wallet --node "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:18444"')]),t._v(" --wallet bdk-test -d $BDK_recv_desc -c $BDK_chng_desc create_tx --to $core_addrs:200000000 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" jq -r "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.psbt'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])]),e("p",[t._v("(Recommended to check all the other information returned by "),e("code",[t._v("bdk-cli create_tx")]),t._v(")")])])]),t._v(" "),e("h3",{attrs:{id:"sign-and-broadcast-the-transaction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sign-and-broadcast-the-transaction"}},[t._v("#")]),t._v(" Sign and Broadcast the transaction")]),t._v(" "),e("p",[t._v("Asking BDK to sign a transaction is as straight forward as it can get. BDK already holds the "),e("code",[t._v("xprv")]),t._v(" deatils to sign a transaction. It returns a finalised "),e("code",[t._v("signed_psbt")]),t._v(" which we will next broadcast to the network.")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Sign the transaction")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("signed_psbt")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("bdk-cli --network regtest wallet --node "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:18444"')]),t._v(" --wallet bdk-test -d $BDK_recv_desc -c $BDK_chng_desc sign --psbt $psbt "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" jq -r "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.psbt'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Broadcast the transaction")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ bdk-cli --network regtest wallet --node "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:18444"')]),t._v(" --wallet bdk-test -d "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_recv_desc")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_chng_desc")]),t._v(" broadcast --psbt "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$signed_psbt")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"txid"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c343f5b25372e285308eba912d1fe8fade9f64afde6d95306e248e52e0852252"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("This makes BDK broadcast the transaction via the connected core node, and it returns the corresponding Txid.")])])]),t._v(" "),e("h3",{attrs:{id:"confirming-the-transaction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#confirming-the-transaction"}},[t._v("#")]),t._v(" Confirming the Transaction")]),t._v(" "),e("p",[t._v("The transaction has been received by the "),e("code",[t._v("core")]),t._v(" node and waiting in its mempool for inclusion in block.\nWe can see the transaction via its "),e("code",[t._v("txid")]),t._v(" received in previous step.")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Check transaction in mempool")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it bdk-box /root/bitcoin-cli -regtest gettransaction c343f5b25372e285308eba912d1fe8fade9f64afde6d95306e2248e52e0852252\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"amount"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.00000000")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"confirmations"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trusted"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" false,\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"txid"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c343f5b25372e285308eba912d1fe8fade9f64afde6d95306e248e52e0852252"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"walletconflicts"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"time"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1621697202")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timereceived"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1621697202")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bip125-replaceable"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"no"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"details"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"address"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bcrt1q3h4hs6mve5dcl7da3d4acmlp20hh8c3t4mldwe"')]),t._v(",\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"category"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"receive"')]),t._v(",\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"amount"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.00000000")]),t._v(",\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"label"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(",\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vout"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hex"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"01000000000101d84e8cb7477f9fe6f265b56d5416ff47da9a70be18f65ec50731b8257c67f2bd0100000000ffffffff0273a2e11100000000160014874270187001febc4cebd8cb083cf2c783e8f1ac00c2eb0b000000001600148deb786b6ccd1b8ff9bd8b6bdc6fe153ef73e22b0247304402201037d9ef5b80392296311c8899b1f12a0987778d694a442a88bafa6fbd7a7c9a022011293176255897444d9c71b0b9cd13b2aedb749b142577566c90a63d61025e2c01210202427d16b29c1c8546255363a74326ee9ab3196770bb3fccc7b679d52f9c1ccf00000000"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("This means, core has recieved the transaction in its mempool and waiting for confirmation.")])]),t._v(" "),e("li",[e("p",[t._v("Generate 1 block to confirm the transaction")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it bdk-box /root/bitcoin-cli -regtest generatetoaddress "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" bcrt1qatd7yq0jukwusuaufltlejmeydpvnpv43r5gc2\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"55436ff0169bbb3e70ab10cb7cdd45ab86204d5d7864a109142d91120d023197"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Sync the "),e("code",[t._v("bdk-test")]),t._v(" wallet and ask for available balance.")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("  $ bdk-cli --network regtest wallet --node "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:18444"')]),t._v(" --wallet bdk-test -d "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_recv_desc")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_chng_desc")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  $ bdk-cli --network regtest wallet --node "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:18444"')]),t._v(" --wallet bdk-test -d "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_recv_desc")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BDK_chng_desc")]),t._v(" get_balance\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"satoshi"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("299999859")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("If you see the balance updated, voila!")]),t._v(" "),e("p",[t._v("What happened here is:")]),t._v(" "),e("ul",[e("li",[t._v("core created a new block containing the transaction.")]),t._v(" "),e("li",[e("code",[t._v("bdk-cli")]),t._v(" fetched the corresponding filter data.")]),t._v(" "),e("li",[t._v("It noticed it got a concerning transaction.")]),t._v(" "),e("li",[t._v("It asked for the details of that transaction from the core node.")]),t._v(" "),e("li",[t._v("It updated its wallet details with this new information.")]),t._v(" "),e("li",[t._v("The update is reflected in the wallet balance.")])])])]),t._v(" "),e("h3",{attrs:{id:"shutdown-docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#shutdown-docker"}},[t._v("#")]),t._v(" Shutdown Docker")]),t._v(" "),e("p",[t._v("You may now shutdown the regtest docker container.")]),t._v(" "),e("p",[t._v("Note: This will also clean up any data in the bitcoin core, including the wallet.")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" bdk-box\n")])])]),e("h2",{attrs:{id:"end-words"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#end-words"}},[t._v("#")]),t._v(" End Words")]),t._v(" "),e("p",[t._v("In this tutorial we went through the process of receiving, creating, signing and broadcasting transaction using the BDK wallet with "),e("code",[t._v("compact_filters")]),t._v(" feature. This demonstrates how BDK capabilities can be used to create SPV light wallets with integrated "),e("code",[t._v("BIP157")]),t._v(" type "),e("code",[t._v("compact_filters")]),t._v(" node.")])])}),[],!1,null,null,null);e.default=n.exports}}]);